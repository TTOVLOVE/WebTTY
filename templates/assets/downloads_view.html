{% extends "dashboard/base.html" %}

{% block title %}文件浏览器 - WebTTY{% endblock %}

{% block extra_css %}
<style>
.table-responsive {
    border-radius: 10px;
    overflow: hidden;
}

.table {
    margin-bottom: 0;
}

.table thead th {
    background: #f8f9fa;
    border: none;
    padding: 15px 20px;
    font-weight: 600;
    color: #495057;
    font-size: 0.9rem;
}

.table tbody td {
    padding: 15px 20px;
    border: none;
    border-bottom: 1px solid #f1f3f4;
    vertical-align: middle;
}

.table tbody tr:hover {
    background-color: #f8f9fa;
}

.table tbody tr:last-child td {
    border-bottom: none;
}

.badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-info {
    background-color: #17a2b8;
    color: white;
}

.btn-group {
    display: flex;
    gap: 5px;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
    border-radius: 6px;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    color: #ddd;
}

.empty-state h3 {
    margin-bottom: 15px;
    color: #666;
}

.empty-state p {
    margin-bottom: 25px;
    color: #999;
    line-height: 1.6;
}

.file-icon {
    font-size: 1.5rem;
    color: #667eea;
}

.file-info {
    display: flex;
    flex-direction: column;
}

.file-name {
    font-weight: 500;
    color: #333;
    margin-bottom: 2px;
}

.file-extension {
    font-size: 0.75rem;
    color: #6c757d;
    text-transform: uppercase;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: #e8f5e8;
    border-radius: 20px;
    color: #28a745;
    font-size: 0.9rem;
    font-weight: 500;
}

.status-indicator i {
    font-size: 1.1rem;
}
</style>
{% endblock %}

{% block content %}
<div class="page-header">
  <div class="page-title">
    <i class='bx bx-folder'></i>
    <div>
      <h1>文件浏览器</h1>
      <p class="page-subtitle">管理下载的文件和资源</p>
    </div>
  </div>
  <div class="page-actions">
    <div class="status-indicator">
      <i class='bx bx-folder'></i>
      <span class="status-text">{{ files|length }} 个文件</span>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <i class='bx bx-folder-open'></i>
    下载文件列表
  </div>
  <div class="card-body p-0">
    {% if files %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col" class="ps-4">
              <i class='bx bx-file'></i>
              文件名
            </th>
            <th scope="col">
              <i class='bx bx-data'></i>
              文件大小
            </th>
            <th scope="col">
              <i class='bx bx-time'></i>
              修改日期
            </th>
            <th scope="col" class="text-center">
              <i class='bx bx-cog'></i>
              操作
            </th>
          </tr>
        </thead>
        <tbody>
          {% for file in files %}
          <tr class="align-middle">
            <td class="ps-4">
              <div class="d-flex align-items-center gap-3">
                <i class='bx bxs-file-blank file-icon'></i>
                <div class="file-info">
                  <div class="file-name">{{ file.name }}</div>
                  <small class="file-extension">{{ file.name.split('.')[-1].upper() if '.' in file.name else 'FILE' }}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="badge badge-info">{{ file.size }}</span>
            </td>
            <td class="text-muted">
              <i class='bx bx-calendar me-1'></i>
              {{ file.modified_time }}
            </td>
            <td class="text-center">
              <div class="btn-group" role="group">
                <a href="{{ file.url }}" class="btn btn-primary btn-sm" download>
                  <i class='bx bx-download'></i>
                  下载
                </a>
                <button class="btn btn-danger btn-sm" onclick="deleteFile('{{ file.name }}')">
                  <i class='bx bx-trash'></i>
                  删除
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <i class='bx bx-folder-open'></i>
      <h3>暂无文件</h3>
      <p>下载文件夹为空，使用控制台下载文件后将在此处显示。</p>
      <a href="{{ url_for('dashboard.index') }}" class="btn btn-primary">
        <i class='bx bx-terminal'></i>
        前往控制台
      </a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function deleteFile(filename) {
  if (confirm('确定要删除这个文件吗？')) {
    fetch(`/delete_file/${filename}`, {
      method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
        showNotification('文件删除成功', 'success');
      } else {
        showNotification('删除失败：' + data.error, 'error');
      }
    })
    .catch(error => {
      showNotification('删除失败：' + error, 'error');
    });
  }
}

function showNotification(message, type) {
  // 创建通知元素
  const notification = document.createElement('div');
  notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
  notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
  notification.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `;
  
  document.body.appendChild(notification);
  
  // 3秒后自动移除
  setTimeout(() => {
    if (notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 3000);
}
</script>
{% endblock %}