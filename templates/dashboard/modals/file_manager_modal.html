<div class="modal-overlay" id="fileManagerModal" style="display: none;">
  <div class="modal-content" style="max-width: 1200px; width: 95%; max-height: 90vh;">
    <div class="modal-header">
      <h3 class="modal-title">文件管理器 - 客户端 <span id="fm-client-id"></span></h3>
      <button class="modal-close" onclick="closeFileManagerModal()">&times;</button>
    </div>
    <div class="modal-body" style="padding: 0; height: 70vh;">
      <div class="file-manager-container" style="height: 100%; display: flex; flex-direction: column;">
        <!-- 工具栏 -->
        <div class="file-manager-toolbar" style="padding: 1rem; border-bottom: 1px solid var(--border-color); flex-shrink: 0;">
          <div class="row g-2 align-items-end">
            <div class="col-md-8">
              <div class="input-group">
                <span class="input-group-text"><i class='bx bx-folder'></i></span>
                <input type="text" id="fm-path" class="form-control" placeholder="输入路径或留空使用当前目录" value=".">
                <button id="fm-btn-list" class="btn btn-primary">
                  <i class='bx bx-list-ul'></i> 列出
                </button>
                <button id="fm-btn-up" class="btn btn-secondary">
                  <i class='bx bx-up-arrow-alt'></i> 上级
                </button>
              </div>
            </div>
            <div class="col-md-4">
              <div class="upload-area" style="display: flex; gap: 0.5rem;">
                <input type="file" id="fm-upload-input" class="form-control form-control-sm">
                <button id="fm-btn-upload" class="btn btn-success btn-sm">
                  <i class='bx bx-upload'></i> 上传
                </button>
              </div>
            </div>
          </div>
          <div class="upload-progress" id="fm-upload-progress" style="margin-top: 0.5rem; display: none;">
            <div class="progress-bar" style="width: 100%; height: 4px; background: var(--border-color); border-radius: 2px; overflow: hidden;">
              <div class="upload-progress-bar" id="fm-upload-progress-bar" style="height: 100%; background: var(--success-color); width: 0%; transition: width 0.3s ease;"></div>
            </div>
          </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="file-manager-content" style="flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 0; min-height: 0;">
          <!-- 文件列表面板 -->
          <div class="file-list-panel" style="display: flex; flex-direction: column; border-right: 1px solid var(--border-color);">
            <div class="panel-header" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 1rem; font-weight: 600;">
              <i class='bx bx-folder-open'></i> 文件列表
            </div>
            <div class="file-table-container" style="flex: 1; overflow: auto;">
              <table class="file-table" id="fm-files-tbl" style="width: 100%; border-collapse: collapse;">
                <thead>
                  <tr style="background: var(--light-bg); position: sticky; top: 0; z-index: 1;">
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.875rem;"><i class='bx bx-file'></i> 名称</th>
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.875rem;"><i class='bx bx-category'></i> 类型</th>
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.875rem;"><i class='bx bx-data'></i> 大小</th>
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.875rem;"><i class='bx bx-time'></i> 修改时间</th>
                    <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.875rem;"><i class='bx bx-cog'></i> 操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-muted);">
                      <i class='bx bx-info-circle'></i> 等待操作...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="status-bar" style="padding: 0.75rem; background: var(--light-bg); border-top: 1px solid var(--border-color); font-size: 0.875rem; color: var(--text-secondary);">
              <div id="fm-status"><i class='bx bx-info-circle'></i> 准备就绪</div>
            </div>
          </div>

          <!-- 文件内容面板 -->
          <div class="file-content-panel" style="display: flex; flex-direction: column;">
            <div class="panel-header" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 1rem; font-weight: 600;">
              <i class='bx bx-file-blank'></i> 文件内容 / 输出
            </div>
            <div class="file-content" style="flex: 1; padding: 1rem; overflow: auto;">
              <pre id="fm-file-text" style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: var(--radius-md); font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace; font-size: 0.875rem; line-height: 1.6; white-space: pre-wrap; word-break: break-word; margin: 0; min-height: 100%;">请选择文件进行操作。</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* 文件管理器模态框专用样式 */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
  display: flex !important;
}

.modal-content {
  background: var(--card-bg);
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  transform: scale(0.9);
  transition: all 0.3s ease;
}

.modal-overlay.active .modal-content {
  transform: scale(1);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
  background: var(--light-bg);
}

.modal-header h3 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 0;
  width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.5rem;
  transition: all 0.3s ease;
}

.modal-close:hover {
  background: var(--light-bg);
  color: var(--text-primary);
}

.modal-body {
  padding: 0;
}

.file-table tbody tr:hover {
  background: var(--light-bg);
}

.file-actions {
  display: flex;
  gap: 0.25rem;
}

.file-actions .btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
}

@media (max-width: 768px) {
  .modal-content {
    width: 95%;
    max-width: none;
    margin: 1rem;
  }
  
  .file-manager-content {
    grid-template-columns: 1fr !important;
    grid-template-rows: 1fr 1fr;
  }
}
</style>